# 解释器构造实验

## CMM语言

CMM（C Minus Minus／C- -）语言为C语言的一个子集，其基础定义如下：

- 语言结构：顺序结构（赋值语句、输入、输出）、选择语句（if-else）、循环结构（while）。这些语句结构和C语言的结构一样，允许嵌套。
- 表达式局限于关系表达式和算术表达式，运算的优先级为：算术运算、关系运算，并服从左结合规则。
- 算术表达式包括整数和实数上的运算、变量及“（）”、“\*”、“+”、“-”、“/”，运算符的优先级顺序为：“（）”大于“*”和“/”大于“+”和“-”。
- 关系运算符包括：“<”、“==”、“<>”。 
- 一条语句以“；”结束；程序由一条语句或者由“{”和“}”嵌套表达的复合语句。
- 支持多行注释（使用“/*”和“\* ”）。
- 支持数组运算，数组的下标必须是正整数，使用“[”和“]”表示数组下标。
- 数组声明方式和Java一样，如，`int[]`，可以直接通过获得数组的长度。
- 变量的使用之前需要先声明，声明的方式和C语言一样。
- 十进制的整数int与实数real，布尔类型bool。
- 标识符（由数字、字母和下划线组成的串，但必须以字母开头、且不能以下划线结尾的串）。​	
- 无类、对象的概念，函数直接定义，直接调用。

| 保留字 | 特殊符号 |
| ------ | -------- |
| if     | +        |
| else   | -        |
| while  | *        |
| read   | /        |
| write  | =        |
| int    | <        |
| real   | >        |
| bool   | ==       |
|        | <>       |
|        | (        |
|        | )        |
|        | {        |
|        | }        |
|        | /*       |
|        | */       |
|        | [        |
|        | ]        |
|        | ;        |

### 词法分析

#### 1. EBNF

1. \<无符号整数> : : = \<数字>{\<数字>}
2. \<无符号实数> : : = \<数字>{\<数字>}'.'\<数字>{\<数字>}
3. \<数字> : : = '0' | '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9'
4. \<运算符> : : = '+' | '-' | '*' | '/' | '<' | '>' | '<>' | '==' |'='
5. \<界符> : : = '(' | ')' | '[' | ']' | '{' | '}' | ',' | ';'
6. \<标识符> : : = <字母> | <字母>（ <字母> | <数字> | '_' )* ( <字母> | <数字> ) +> | <#字母 : ["a"-"z","A"-"Z"]> | 
7. \<关键字> : : = <"IF": if> | <"ELSE": else> | <"WHILE": while> | <"READ": read> | <"WRITE": write> | <"INT": int> | <"REAL": real> | <"BOOL": bool> 
8. \<注释> : : = '//' | '/\*' | '*/' 

#### 2. 状态转换图

![词法分析状态转换图-9140276](images/词法分析状态转换图.png)

#### 3. 扫描程序框图

![词法分析器流程图-9140282](images/词法分析器流程图.png)

#### 4. 词法分析表

| 类型type            | 单词记号token     | 单词种别symbol | 种别码 |
| ------------------- | ----------------- | -------------- | ------ |
| 1    Constant 常数  | <INTEGER_LITERAL> | INTEGER        | 0      |
|                     | <REAL_LITERAL>    | REAL           | 1      |
| 2   Operator 运算符 | +                 | PLUS           | 2      |
|                     | -                 | MINUS          | 3      |
|                     | *                 | TIMES          | 4      |
|                     | /                 | DIVIDE         | 5      |
|                     | <                 | LESS           | 6      |
|                     | >                 | GREATER        | 7      |
|                     | <>                | NOTEQUAL       | 8      |
|                     | ==                | EQUAL          | 9      |
|                     | =                 | ASSIGN         | 10     |
| 3  Delimiter 界符   | (                 | LEFT_PAR       | 11     |
|                     | )                 | RIGHT_PAR      | 12     |
|                     | [                 | LEFT_BRA       | 13     |
|                     | ]                 | RIGHT_BRA      | 14     |
|                     | {                 | LEFT_CUR       | 15     |
|                     | }                 | RIGHT_CUR      | 16     |
|                     | ,                 | COMMA          | 17     |
|                     | ;                 | SEMI           | 18     |
| 4 标识符            | \<IDENTIFIER>     | IDENTIFIER     | 19     |
| 5 关键字            | if                | IF             | 20     |
|                     | else              | ELSE           | 21     |
|                     | while             | WHILE          | 22     |
|                     | read              | READ           | 23     |
|                     | write             | WRITE          | 24     |
|                     | int               | INT            | 25     |
|                     | real              | REAL           | 26     |
|                     | bool              | BOOL           | 27     |
| 6 注释              | //                | COMMENT        | 28     |
|                     | /*                | LEFT_COM       | 29     |
|                     | \*/               | RIGHT_COM      | 30     |

再加上出错类型：ERROR。



### 语法分析（EBNF）

| 类型                     | 定义为 |                                                    |
| ------------------------ | ------ | -------------------------------------------------- |
| VarDeclaration           | ::=    | Type Identifier ";"                                |
| Type                     | ::=    | Identifier                                         |
|                          |        | \| BooleanType                                     |
|                          |        | \| IntegerType                                     |
|                          |        | \| RealType                                        |
|                          |        | \|  ArrayType                                      |
| ArrayType                | ::=    | "int" "[" "]"                                      |
| ==（与Java类似）==       |        | \| "real" "[" "]"                                  |
|                          |        | \| "bool" "[" "]"                                  |
| BooleanType              | ::=    | "bool"                                             |
| IntegerType              | ::=    | "int"                                              |
| RealType              | ::=    | "real"                                              |
| Statement                | ::=    | Block                                              |
|                          |        | \|  AssignmentStatement                            |
|                          |        | \|  ArrayAssignmentStatement                       |
|                          |        | \|  IfStatement                                    |
|                          |        | \|  WhileStatement                                 |
|                          |        | \|  ReadStatement                                  |
|                          |        | \|  WriteStatement                                 |
| Block                    | ::=    | "{" ( Statement )\* "}"                            |
| AssignmentStatement      | ::=    | Identifier "=" Expression ";"                      |
| ArrayAssignmentStatement | ::=    | Identifier "[" Expression "]" "=" Expression ";"   |
| IfStatement              | ::=    | "if" "(" Expression ")" Statement "else" Statement |
| WhileStatement           | ::=    | "while" "(" Expression ")" Statement               |
| WriteStatement           | ::=    | "write" "(" Expression ")" ";"                     |
| ReadStatement            | ::=    | "read"  "(" Expression ")" ";"                     |
| Expression               | ::=    | PlusExpression                                     |
|                          |        | \| MinusExpression                                 |
|                          |        | \|  TimesExpression                                |
|                          |        | \|  DivideExpression                               |
|                          |        | \|  CompareExpression                              |
|                          |        | \|  ArrayLookup                                    |
|                          |        | \|  ArrayLength                                    |
|                          |        | \|  PrimaryExpression                              |
| CompareExpression        | ::=    | PrimaryExpression "<" PrimaryExpression            |
|                          |        | \|  PrimaryExpression ">" PrimaryExpression        |
|                          |        | \|  PrimaryExpression "<>" PrimaryExpression       |
| PlusExpression           | ::=    | PrimaryExpression "+" PrimaryExpression            |
| MinusExpression          | ::=    | PrimaryExpression "-" PrimaryExpression            |
| TimesExpression          | ::=    | PrimaryExpression "\*" PrimaryExpression           |
| DivideExpression          | ::=    | PrimaryExpression "/" PrimaryExpression           |
| ArrayLookup              | ::=    | PrimaryExpression "[" PrimaryExpression "]"        |
| ArrayLength              | ::=    | PrimaryExpression "." "length"                     |
| ExpressionList           | ::=    | Expression ( ExpressionRest )\*                    |
| ExpressionRest           | ::=    | "," Expression                                     |
| PrimaryExpression        | ::=    | IntegerLiteral                                     |
|                          |        | \|  RealLiteral                                    |
|                          |        | \|  TrueLiteral                                    |
|                          |        | \|  FalseLiteral                                   |
|                          |        | \|  BracketExpression                              |
|                          |        | \|  Identifier                                     |
| IntegerLiteral           | ::=    | <INTEGER_LITERAL>                                  |
| RealLiteral              | ::=    | <REAL_LITERAL>                                     |
| TrueLiteral              | ::=    | "true"                                             |
| FalseLiteral             | ::=    | "false"                                            |
| Identifier               | ::=    | \<IDENTIFIER>                                      |
| BracketExpression        | ::=    | "(" Expression ")"                                 |

### 语义分析（非形式化描述）

- 语言结构：顺序结构（赋值语句、输入、输出）、选择语句（if-else）、循环结构（while）。这些语句结构和C语言的结构一样，允许嵌套。
- 表达式局限于关系表达式和算术表达式，运算的优先级为：算术运算、关系运算，并服从左结合规则。
- 算术表达式包括整数和实数上的运算、变量及“（）”、“\*”、“+”、“-”、“/”，运算符的优先级顺序为：“（）”大于“*”和“/”大于“+”和“-”。
- 关系运算符包括：“<”、“==”、“<>”。 
- 一条语句以“；”结束；程序由一条语句或者由“{”和“}”嵌套表达的复合语句。
- 支持多行注释（使用“/*”和“\* ”）。
- 支持数组运算，数组的下标必须是正整数，使用“[”和“]”表示数组下标。
- 数组声明方式和Java一样，如，`int[]`，可以直接通过获得数组的长度。
- 变量的使用之前需要先声明，声明的方式和C语言一样。
- 十进制的整数int与实数real，布尔类型bool。
- 标识符（由数字、字母和下划线组成的串，但必须以字母开头、且不能以下划线结尾的串）。​	
- 无类、对象的概念，函数直接定义，直接调用。

### 测试用例

